配置方法
====

下面的方法从 Servlet 3.0 开始添加到 ServletContext，以便启用编程方式定义 Servlet、Filter 和它们映射到的 url 模式。这些方法只能从 ServletContextListener 实现的 contexInitialized 方法或者ServletContainerInitializer 实现的 onStartup 方法进行的应用初始化过程中调用。 除了添加 Servlet 和 Filter，也可以查找关联到Servlet 或 Filter 的一个 Registration 对象实例，或者到 Servlet 或 Filter 的所有 Registration 对象的 map。
如果 ServletContext 传到了 ServletContextListener 的contextInitialized 方法，但该 ServletContextListener 即没有在 web.xml 或 web-fragment.xml 中声明也没有使用 @WebListener 注解，则在 ServletContext 中定义的用于
Servlet、Filter 和 Listener 的编程式配置的所有方法必须抛出UnsupportedOperationException。

### 编程式添加和配置 Servlet

编程式添加 Servlet 到上下文对框架开发者是很有用的。例如，框架可以使用这个方法声明一个控制器 servlet。这个方法将返回一个ServletRegistration 或 ServletRegistration.Dynamic 对象，允许我们进一步配置如 init-params，url-mapping 等 Servlet 的其他参数。下面描述了该方法的三个重载版本。

#### 4.4.1.1 addServlet(String servletName, String className)

This method allows the application to declare a servlet programmatically. It adds the
servlet with the given name, and class name to the servlet context.

#### 4.4.1.2 addServlet(String servletName, Servlet servlet)

This method allows the application to declare a servlet programmatically. It adds the
servlet with the given name, and servlet instance to the servlet context.

#### 4.4.1.3 addServlet(String servletName, Class <? extends Servlet>
servletClass)
This method allows the application to declare a servlet programmatically. It adds the
servlet with the given name, and an instance of the servlet class to the servlet
context.

#### 4.4.1.4 <T extends Servlet> T createServlet(Class<T> clazz)
This method instantiates the given Servlet class. The method must support all the
annotations applicable to Servlets except @WebServlet. The returned Servlet
instance may be further customized before it is registered with the
ServletContext via a call to addServlet(String, Servlet) as defined above.
4-36 Java Servlet Specification • April 2013
#### 4.4.1.5 ServletRegistration getServletRegistration(String servletName)


This method returns the ServletRegistration corresponding to the servlet with
the given name, or null if no ServletRegistration exists under that name. An
UnsupportedOperationException is thrown if the ServletContext was
passed to the contextInitialized method of a ServletContextListener that
was neither declared in the web.xml or web-fragment.xml, nor annotated with
javax.servlet.annotation.WebListener.

#### 4.4.1.6 Map<String, ? extends ServletRegistration> getServletRegistrations()

This method returns a map of ServletRegistration objects, keyed by name
corresponding to all servlets registered with the ServletContext. If there are no
servlets registered with the ServletContext an empty map is returned. The returned
Map includes the ServletRegistration objects corresponding to all declared and
annotated servlets, as well as the ServletRegistration objects corresponding to all
servlets that have been added via one of the addServlet methods. Any changes to
the returned Map MUST not affect the ServletContext. An
UnsupportedOperationException is thrown if the ServletContext was
passed to the contextInitialized method of a ServletContextListener that
was neither declared in the web.xml or web-fragment.xml, nor annotated with
javax.servlet.annotation.WebListener.